<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-language Code Formatter | DevCrate</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Prettier Standalone -->
    <script src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
    <!-- Prettier Parsers/Plugins -->
    <script src="https://unpkg.com/prettier@2.8.8/parser-babel.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-html.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-postcss.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-typescript.js"></script>
    <script src="https://unpkg.com/@prettier/plugin-php@0.19.6/dist/standalone.js"></script>
    <script src="https://unpkg.com/prettier-plugin-java/dist/standalone.js"></script>
    <script src="https://unpkg.com/prettier-plugin-sql/dist/standalone.js"></script>

    <script>
      // Tailwind CSS Configuration
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
            },
            fontFamily: {
              mono: ['"Fira Code"', '"Courier New"', "monospace"],
            },
          },
        },
      };
    </script>
    <style>
      /* General Transitions and Effects */
      .theme-toggle {
        transition: all 0.3s ease;
      }
      .theme-toggle:hover {
        transform: rotate(30deg);
      }
      .btn-primary,
      .btn-secondary {
        transition: all 0.2s ease;
      }
      .btn-primary:hover,
      .btn-secondary:hover {
        transform: translateY(-1px);
      }
      .code-editor {
        min-height: 300px;
        font-family: "Fira Code", "Courier New", monospace;
        line-height: 1.6;
        tab-size: 4;
      }
      #outputCode {
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      @keyframes pulse {
        50% {
          opacity: 0.6;
        }
      }
      .animate-pulse-fast {
        animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    </style>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="flex justify-between items-center mb-8">
        <div>
          <a href="#" class="flex items-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
              Dev<span class="text-primary-600 dark:text-primary-400"
                >Crate</span
              >
            </h1>
          </a>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            Multi-language Code Formatter
          </p>
        </div>
        <button
          id="themeToggle"
          class="theme-toggle bg-gray-200 dark:bg-gray-700 rounded-full p-3 text-gray-700 dark:text-gray-200"
        >
          <i class="fas fa-moon dark:hidden"></i>
          <i class="fas fa-sun hidden dark:block"></i>
        </button>
      </header>

      <!-- Main Content -->
      <main>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <!-- Input Section -->
          <div
            class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden"
          >
            <div
              class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"
            >
              <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                Input Code
              </h2>
              <div class="flex items-center space-x-2">
                <select
                  id="languageSelect"
                  class="language-selector bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white px-3 py-1 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                >
                  <option value="babel">JavaScript</option>
                  <option value="typescript">TypeScript</option>
                  <option value="html">HTML</option>
                  <option value="css">CSS</option>
                  <option value="php">PHP</option>
                  <option value="java">Java</option>
                  <option value="sql">SQL</option>
                </select>
                <button
                  id="clearBtn"
                  class="text-gray-500 hover:text-primary-500"
                  title="Clear input"
                >
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </div>
            <textarea
              id="inputCode"
              class="code-editor w-full p-4 text-gray-900 dark:text-gray-100 bg-white dark:bg-gray-800 focus:outline-none resize-none"
              placeholder="Paste your code here..."
              spellcheck="false"
            ></textarea>
          </div>

          <!-- Output Section -->
          <div
            class="bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden"
          >
            <div
              class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"
            >
              <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                Formatted Code
              </h2>
              <div class="flex items-center space-x-2">
                <button
                  id="copyBtn"
                  class="text-gray-500 hover:text-primary-500"
                  title="Copy to clipboard"
                >
                  <i class="fas fa-copy"></i>
                </button>
                <button
                  id="downloadBtn"
                  class="text-gray-500 hover:text-primary-500"
                  title="Download"
                >
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <pre
              id="outputCode"
              class="code-editor w-full p-4 text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-900 overflow-auto"
            ><span class="text-gray-400 dark:text-gray-500">// Formatted code will appear here...</span></pre>
          </div>
        </div>

        <!-- Format Options -->
        <div
          class="mt-8 bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6"
        >
          <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">
            Formatting Options
          </h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Indentation</label
              >
              <select
                id="indentSelect"
                class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              >
                <option value="2">2 spaces</option>
                <option value="4" selected>4 spaces</option>
                <option value="tab">Tab</option>
              </select>
            </div>
            <div>
              <label
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >Max Line Length</label
              >
              <input
                type="number"
                id="lineLength"
                value="80"
                min="40"
                max="200"
                class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              />
            </div>
            <div class="space-y-2">
              <label
                id="semicolonsContainer"
                class="flex items-center space-x-2"
              >
                <input
                  type="checkbox"
                  id="semicolons"
                  class="rounded text-primary-600 focus:ring-primary-500"
                  checked
                />
                <span class="text-sm text-gray-700 dark:text-gray-300"
                  >Add semicolons (JS/TS)</span
                >
              </label>
              <label class="flex items-center space-x-2">
                <input
                  type="checkbox"
                  id="quoteStyle"
                  class="rounded text-primary-600 focus:ring-primary-500"
                />
                <span class="text-sm text-gray-700 dark:text-gray-300"
                  >Use single quotes</span
                >
              </label>
            </div>
          </div>
          <div class="mt-6 flex flex-wrap gap-3">
            <button
              id="formatBtn"
              class="btn-primary px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md font-medium"
            >
              <i class="fas fa-magic mr-2"></i> Format Code
            </button>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer
        class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700 text-center text-gray-600 dark:text-gray-400"
      >
        <p>© 2025 DevCrate. All tools are free to use.</p>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const themeToggle = document.getElementById("themeToggle");
        const inputCode = document.getElementById("inputCode");
        const outputCode = document.getElementById("outputCode");
        const languageSelect = document.getElementById("languageSelect");
        const formatBtn = document.getElementById("formatBtn");
        const clearBtn = document.getElementById("clearBtn");
        const copyBtn = document.getElementById("copyBtn");
        const downloadBtn = document.getElementById("downloadBtn");

        // --- Prettier Plugins ---
        // These are loaded from the script tags in the <head> and available on the window object.
        const prettierPlugins = window.prettierPlugins;

        // --- Utility Functions ---
        const showNotification = (message, isError = false) => {
          const notification = document.createElement("div");
          notification.textContent = message;
          notification.className = `fixed bottom-5 right-5 px-4 py-2 rounded-md text-white shadow-lg ${
            isError ? "bg-red-500" : "bg-green-500"
          }`;
          document.body.appendChild(notification);
          setTimeout(() => {
            notification.remove();
          }, 3000);
        };

        const copyToClipboard = (text, button) => {
          if (!text || text.includes("// Formatted code will appear here...")) {
            showNotification("Nothing to copy!", true);
            return;
          }
          const textArea = document.createElement("textarea");
          textArea.style.position = "fixed";
          textArea.style.top = "-9999px";
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          try {
            document.execCommand("copy");
            const originalIcon = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check text-green-500"></i>';
            setTimeout(() => {
              button.innerHTML = originalIcon;
            }, 2000);
          } catch (err) {
            showNotification("Failed to copy!", true);
          }
          document.body.removeChild(textArea);
        };

        const updateSemicolonOptionVisibility = () => {
          const lang = languageSelect.value;
          const container = document.getElementById("semicolonsContainer");
          if (lang === "babel" || lang === "typescript") {
            container.style.display = "flex";
          } else {
            container.style.display = "none";
          }
        };

        // --- Formatting Logic ---
        const formatCode = () => {
          const code = inputCode.value;
          if (!code.trim()) {
            showNotification("Please enter some code to format.", true);
            return;
          }

          // Show loading state
          outputCode.innerHTML =
            '<span class="text-gray-500 dark:text-gray-400 animate-pulse-fast">Formatting...</span>';
          formatBtn.disabled = true;

          setTimeout(() => {
            try {
              const indent = document.getElementById("indentSelect").value;
              const options = {
                parser: languageSelect.value,
                plugins: prettierPlugins,
                printWidth:
                  parseInt(document.getElementById("lineLength").value) || 80,
                tabWidth: indent === "tab" ? 2 : parseInt(indent), // default tabWidth
                useTabs: indent === "tab",
                semi: document.getElementById("semicolons").checked,
                singleQuote: document.getElementById("quoteStyle").checked,
                // Add other common options for good formatting
                trailingComma: "es5",
                bracketSpacing: true,
                arrowParens: "always",
              };

              // Handle SQL dialect specifically if needed
              if (options.parser === "sql") {
                options.language = "sql"; // or 'mysql', 'plsql' etc.
              }

              const formatted = prettier.format(code, options);
              outputCode.textContent = formatted;
            } catch (e) {
              // Detect parser/language mismatch
              let message = e.message;
              if (
                message.includes("SyntaxError") ||
                message.includes("Unexpected token") ||
                message.includes("No parser could be inferred")
              ) {
                message =
                  "Formatting failed: The code does not match the selected language or contains syntax errors.";
              }
              outputCode.innerHTML = `<span class="text-red-500">Error: ${message}</span>`;
              showNotification(message, true);
              console.error(e);
            } finally {
              formatBtn.disabled = false;
            }
          }, 50); // Small timeout to allow UI to update to "Formatting..."
        };

        // --- Event Listeners ---
        formatBtn.addEventListener("click", formatCode);
        languageSelect.addEventListener(
          "change",
          updateSemicolonOptionVisibility
        );

        clearBtn.addEventListener("click", () => {
          inputCode.value = "";
          outputCode.innerHTML =
            '<span class="text-gray-400 dark:text-gray-500">// Formatted code will appear here...</span>';
        });

        copyBtn.addEventListener("click", () => {
          copyToClipboard(outputCode.textContent, copyBtn);
        });

        downloadBtn.addEventListener("click", () => {
          const text = outputCode.textContent;
          if (!text || text.includes("// Formatted code will appear here...")) {
            showNotification("Nothing to download!", true);
            return;
          }
          const lang = languageSelect.value;
          const extensionMap = {
            babel: "js",
            typescript: "ts",
            html: "html",
            css: "css",
            php: "php",
            java: "java",
            sql: "sql",
          };
          const extension = extensionMap[lang] || "txt";
          const blob = new Blob([text], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `formatted-code.${extension}`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });

        themeToggle.addEventListener("click", () => {
          document.documentElement.classList.toggle("dark");
          localStorage.setItem(
            "theme",
            document.documentElement.classList.contains("dark")
              ? "dark"
              : "light"
          );
        });

        // --- Initialization ---
        if (
          localStorage.getItem("theme") === "dark" ||
          (!localStorage.getItem("theme") &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
        }
        updateSemicolonOptionVisibility();
      });
    </script>
    <script>
      // Ensure all plugins are available in window.prettierPlugins
      window.prettierPlugins = window.prettierPlugins || [];
      if (window.prettierPluginPhp)
        window.prettierPlugins.push(window.prettierPluginPhp);
      if (window.prettierPluginJava)
        window.prettierPlugins.push(window.prettierPluginJava);
      if (window.prettierPluginSql)
        window.prettierPlugins.push(window.prettierPluginSql);
    </script>
  </body>
</html>
