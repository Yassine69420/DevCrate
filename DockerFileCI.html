<!DOCTYPE html>
<html lang="en" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dockerfile & CI Generator | DevCrate</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      // Tailwind CSS Configuration
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
            },
            fontFamily: {
              mono: ['"Fira Code"', '"Courier New"', "monospace"],
            },
          },
        },
      };
    </script>
    <style>
      /* General Transitions and Effects */
      .theme-toggle {
        transition: all 0.3s ease;
      }
      .theme-toggle:hover {
        transform: rotate(30deg);
      }
      .btn-primary,
      .btn-secondary {
        transition: all 0.2s ease;
      }
      .btn-primary:hover,
      .btn-secondary:hover {
        transform: translateY(-1px);
      }
      .output-editor {
        min-height: 400px;
        font-family: "Fira Code", "Courier New", monospace;
        line-height: 1.6;
        tab-size: 4;
        white-space: pre-wrap;
        word-wrap: break-word;
      }
      @keyframes pulse {
        50% {
          opacity: 0.6;
        }
      }
      .animate-pulse-fast {
        animation: pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
    </style>
    <!-- Load theme script early to prevent flash -->
    <script src="theme.js"></script>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="flex justify-between items-center mb-8">
        <div>
          <a href="DevCrate.html" class="flex items-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
              Dev<span class="text-primary-600 dark:text-primary-400"
                >Crate</span
              >
            </h1>
          </a>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            Dockerfile & CI Generator
          </p>
        </div>
        <button
          id="themeToggle"
          class="theme-toggle bg-gray-200 dark:bg-gray-700 rounded-full p-3 text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-900"
          aria-label="Toggle dark mode"
        >
          <i id="moonIcon" class="fas fa-moon"></i>
          <i id="sunIcon" class="fas fa-sun hidden"></i>
        </button>
      </header>

      <!-- Main Content -->
      <main>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Configuration Section -->
          <div
            class="lg:col-span-1 bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 p-6 h-fit"
          >
            <h2
              class="text-xl font-semibold text-gray-900 dark:text-white mb-4"
            >
              Configuration
            </h2>
            <div class="space-y-4">
              <div>
                <label
                  for="fileType"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >File Type</label
                >
                <select
                  id="fileType"
                  class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                >
                  <option value="dockerfile">Dockerfile</option>
                  <option value="ci">CI/CD Config</option>
                </select>
              </div>
              <div>
                <label
                  for="projectType"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >Project Type</label
                >
                <select
                  id="projectType"
                  class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                >
                  <option value="nodejs">Node.js</option>
                  <option value="python">Python</option>
                  <option value="go">Go</option>
                  <option value="rust">Rust</option>
                </select>
              </div>
              <div id="ciProviderContainer">
                <label
                  for="ciProvider"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >CI Provider</label
                >
                <select
                  id="ciProvider"
                  class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                >
                  <option value="github">GitHub Actions</option>
                  <option value="gitlab">GitLab CI</option>
                </select>
              </div>
              <div>
                <label
                  for="port"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >Expose Port</label
                >
                <input
                  type="number"
                  id="port"
                  value="3000"
                  class="w-full bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500"
                />
              </div>
            </div>
            <div class="mt-6">
              <button
                id="generateBtn"
                class="w-full btn-primary px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-md font-medium"
              >
                <i class="fas fa-cogs mr-2"></i> Generate
              </button>
            </div>
          </div>

          <!-- Output Section -->
          <div
            class="lg:col-span-2 bg-white dark:bg-gray-800 rounded-xl shadow-md border border-gray-200 dark:border-gray-700 overflow-hidden"
          >
            <div
              class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"
            >
              <h2
                id="outputTitle"
                class="text-lg font-semibold text-gray-900 dark:text-white"
              >
                Generated Dockerfile
              </h2>
              <div class="flex items-center space-x-2">
                <button
                  id="copyBtn"
                  class="text-gray-500 hover:text-primary-500"
                  title="Copy to clipboard"
                >
                  <i class="fas fa-copy"></i>
                </button>
                <button
                  id="downloadBtn"
                  class="text-gray-500 hover:text-primary-500"
                  title="Download"
                >
                  <i class="fas fa-download"></i>
                </button>
              </div>
            </div>
            <pre
              id="outputContent"
              class="output-editor w-full p-4 text-gray-900 dark:text-gray-100 bg-gray-50 dark:bg-gray-900 overflow-auto"
            ><span class="text-gray-400 dark:text-gray-500">// Generated content will appear here...</span></pre>
          </div>
        </div>
      </main>

      <!-- Footer -->
      <footer
        class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700 text-center text-gray-600 dark:text-gray-400"
      >
        <p>Â© 2025 DevCrate. All tools are free to use.</p>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const themeToggle = document.getElementById("themeToggle");
        const generateBtn = document.getElementById("generateBtn");
        const outputContent = document.getElementById("outputContent");
        const outputTitle = document.getElementById("outputTitle");
        const copyBtn = document.getElementById("copyBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        const fileTypeSelect = document.getElementById("fileType");
        const ciProviderContainer = document.getElementById(
          "ciProviderContainer"
        );

        // --- Templates ---
        const templates = {
          dockerfile: {
            nodejs: (port) => `
# Use an official Node.js runtime as a parent image
FROM node:18-alpine

# Set the working directory in the container
WORKDIR /usr/src/app

# Copy package.json and package-lock.json
COPY package*.json ./

# Install app dependencies
RUN npm install

# Bundle app source
COPY . .

# Your app binds to port ${port}
EXPOSE ${port}

# Define the command to run your app
CMD [ "node", "server.js" ]
`,
            python: (port) => `
# Use an official Python runtime as a parent image
FROM python:3.10-slim

# Set the working directory in the container
WORKDIR /usr/src/app

# Copy the requirements file
COPY requirements.txt ./

# Install any needed packages specified in requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Copy the current directory contents into the container at /usr/src/app
COPY . .

# Make port ${port} available to the world outside this container
EXPOSE ${port}

# Run app.py when the container launches
CMD ["python", "app.py"]
`,
            go: (port) => `
# Start from the official Golang base image
FROM golang:1.19-alpine

# Set the working directory
WORKDIR /app

# Copy the Go modules files
COPY go.mod go.sum ./

# Download dependencies
RUN go mod download

# Copy the source code
COPY *.go ./

# Build the Go app
RUN go build -o /docker-gs-ping

# Expose port ${port} to the outside world
EXPOSE ${port}

# Command to run the executable
CMD [ "/docker-gs-ping" ]
`,
            rust: (port) => `
# Start from the official Rust base image
FROM rust:1.65 as builder

WORKDIR /usr/src/app
COPY . .

# Build the release binary
RUN cargo build --release

# Final, smaller image
FROM debian:buster-slim
RUN apt-get update && apt-get install -y libssl-dev ca-certificates && rm -rf /var/lib/apt/lists/*

COPY --from=builder /usr/src/app/target/release/app /usr/local/bin/app

EXPOSE ${port}
CMD ["app"]
`,
          },
          ci: {
            github: {
              nodejs: () => `
name: Node.js CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x, 18.x]

    steps:
    - uses: actions/checkout@v3
    - name: Use Node.js \${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: \${{ matrix.node-version }}
        cache: 'npm'
    - run: npm ci
    - run: npm run build --if-present
    - run: npm test
`,
              python: () => `
name: Python application

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install flake8 pytest
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
    - name: Lint with flake8
      run: |
        # stop the build if there are Python syntax errors or undefined names
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
        # exit-zero treats all errors as warnings. The GitHub editor is 127 chars wide
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics
    - name: Test with pytest
      run: |
        pytest
`,
              go: () => `
name: Go

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Set up Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.20'

    - name: Build
      run: go build -v ./...

    - name: Test
      run: go test -v ./...
`,
              rust: () => `
name: Rust CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Rust toolchain
        uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
          override: true
      - name: Build
        run: cargo build --verbose
      - name: Run tests
        run: cargo test --verbose
`,
            },
            gitlab: {
              nodejs: () => `
image: node:18

stages:
  - build
  - test

cache:
  paths:
    - node_modules/

install_dependencies:
  stage: build
  script:
    - npm install
  artifacts:
    paths:
      - node_modules/

run_tests:
  stage: test
  script:
    - npm test
`,
              python: () => `
image: python:3.10

stages:
  - build
  - test

before_script:
  - pip install -r requirements.txt

lint:
  stage: build
  script:
    - pip install flake8
    - flake8 .

test:
  stage: test
  script:
    - pip install pytest
    - pytest
`,
              go: () => `
image: golang:1.20

stages:
  - test
  - build

test:
  stage: test
  script:
    - go fmt $(go list ./... | grep -v /vendor/)
    - go vet $(go list ./... | grep -v /vendor/)
    - go test -race $(go list ./... | grep -v /vendor/)

build:
  stage: build
  script:
    - go build -race -ldflags "-extldflags '-static'" -o my-app
  artifacts:
    paths:
      - my-app
`,
              rust: () => `
image: rust:latest

stages:
  - build
  - test

build:
  stage: build
  script:
    - cargo build --release --target-dir target
  artifacts:
    paths:
      - target/release/app

test:
  stage: test
  script:
    - cargo test --verbose
`,
            },
          },
        };

        // --- Functions ---
        const generateContent = () => {
          const fileType = fileTypeSelect.value;
          const projectType = document.getElementById("projectType").value;
          const port = document.getElementById("port").value;

          let content = "";
          outputContent.innerHTML =
            '<span class="text-gray-500 dark:text-gray-400 animate-pulse-fast">Generating...</span>';

          setTimeout(() => {
            if (fileType === "dockerfile") {
              outputTitle.textContent = "Generated Dockerfile";
              const template = templates.dockerfile[projectType];
              content = template
                ? template(port).trim()
                : "// Select a project type";
            } else {
              // CI
              const ciProvider = document.getElementById("ciProvider").value;
              outputTitle.textContent = `Generated ${
                ciProvider === "github" ? "GitHub Actions" : "GitLab CI"
              } Config`;
              const providerTemplates = templates.ci[ciProvider];
              if (providerTemplates) {
                const template =
                  providerTemplates[projectType] ||
                  (() =>
                    `# CI/CD for ${projectType} is not yet supported for ${ciProvider}.`);
                content = template().trim();
              } else {
                content = `# ${ciProvider} is not a supported provider.`;
              }
            }
            outputContent.textContent = content;
          }, 200);
        };

        const toggleCIProvider = () => {
          ciProviderContainer.style.display =
            fileTypeSelect.value === "ci" ? "block" : "none";
          generateContent(); // Regenerate when type changes
        };

        const copyToClipboard = (text, button) => {
          if (
            !text ||
            text.includes("// Generated content will appear here...")
          )
            return;
          navigator.clipboard.writeText(text).then(() => {
            const originalIcon = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check text-green-500"></i>';
            setTimeout(() => {
              button.innerHTML = originalIcon;
            }, 2000);
          });
        };

        // --- Event Listeners ---
        generateBtn.addEventListener("click", generateContent);
        fileTypeSelect.addEventListener("change", toggleCIProvider);
        document
          .getElementById("projectType")
          .addEventListener("change", generateContent);
        document
          .getElementById("ciProvider")
          .addEventListener("change", generateContent);

        copyBtn.addEventListener("click", () => {
          copyToClipboard(outputContent.textContent, copyBtn);
        });

        downloadBtn.addEventListener("click", () => {
          const text = outputContent.textContent;
          if (
            !text ||
            text.includes("// Generated content will appear here...")
          )
            return;

          let filename = "Dockerfile";
          if (fileTypeSelect.value === "ci") {
            const provider = document.getElementById("ciProvider").value;
            filename =
              provider === "github"
                ? ".github/workflows/main.yml"
                : ".gitlab-ci.yml";
          }

          const blob = new Blob([text], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        });

        // --- Initialization ---
        toggleCIProvider(); // Set initial state
      });
    </script>
  </body>
</html>
