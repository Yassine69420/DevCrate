<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown Previewer | DevCrate</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Typography Plugin for styling rendered HTML -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <!-- Font Awesome for Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- marked.js for Markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- DOMPurify for sanitizing HTML output (Security) -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
    <!-- highlight.js for syntax highlighting in code blocks -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- html2pdf.js for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
      // Tailwind CSS Configuration
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
            },
            fontFamily: {
              mono: ['"Fira Code"', '"Courier New"', "monospace"],
            },
          },
        },
      };
    </script>
    <style>
      /* General Transitions and Effects */
      .theme-toggle {
        transition: all 0.3s ease;
      }
      .theme-toggle:hover {
        transform: rotate(30deg);
      }
      .btn-secondary {
        transition: all 0.2s ease;
      }
      .btn-secondary:hover {
        transform: translateY(-1px);
      }

      /* Editor and Preview Panes */
      .editor-pane,
      .preview-pane {
        height: 60vh;
        min-height: 400px;
      }

      #markdownInput {
        font-family: "Fira Code", "Courier New", monospace;
        line-height: 1.6;
        tab-size: 4;
      }

      /* Enhanced Dark Mode Prose Styling from user */
      .prose {
        color: rgb(17 24 39);
      }
      .dark .prose {
        color: rgb(229 231 235) !important;
      }
      .dark .prose h1,
      .dark .prose h2,
      .dark .prose h3,
      .dark .prose h4,
      .dark .prose h5,
      .dark .prose h6 {
        color: white !important;
      }
      .dark .prose p,
      .dark .prose li,
      .dark .prose td,
      .dark .prose th {
        color: rgb(229 231 235) !important;
      }
      .dark .prose a {
        color: rgb(56 189 248) !important;
      }
      .dark .prose strong {
        color: white !important;
      }
      .dark .prose code {
        color: rgb(56 189 248) !important;
        background-color: rgb(31 41 55) !important;
      }
      .dark .prose blockquote {
        color: rgb(209 213 219) !important;
        border-left-color: rgb(75 85 99) !important;
      }
      .dark .prose pre {
        background-color: rgb(31 41 55) !important;
      }
      .dark .prose pre code {
        color: rgb(229 231 235) !important;
      }
      .dark .prose table thead th {
        color: white !important;
        border-bottom-color: rgb(75 85 99) !important;
      }
      .dark .prose table tbody td {
        border-bottom-color: rgb(55 65 81) !important;
      }
      .dark .prose hr {
        border-color: rgb(55 65 81) !important;
      }
      .prose pre code.hljs {
        background: none;
      }
    </style>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900 min-h-screen">
    <div class="container mx-auto px-4 py-8">
      <!-- Header -->
      <header class="flex justify-between items-center mb-8">
        <div>
          <a href="DevCrate.html" class="flex items-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
              Dev<span class="text-primary-600 dark:text-primary-400"
                >Crate</span
              >
            </h1>
          </a>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            Markdown Previewer
          </p>
        </div>
        <button
          id="themeToggle"
          class="theme-toggle bg-gray-200 dark:bg-gray-700 rounded-full p-3 text-gray-700 dark:text-gray-200"
        >
          <i class="fas fa-moon dark:hidden"></i>
          <i class="fas fa-sun hidden dark:block"></i>
        </button>
      </header>

      <!-- Main Content -->
      <main>
        <!-- Action Buttons -->
        <div class="mb-4 flex flex-wrap gap-3">
          <button
            id="copyMarkdownBtn"
            class="btn-secondary px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md font-medium text-sm"
          >
            <i class="fab fa-markdown mr-2"></i> Copy Markdown
          </button>
          <button
            id="copyHtmlBtn"
            class="btn-secondary px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md font-medium text-sm"
          >
            <i class="fas fa-code mr-2"></i> Copy HTML
          </button>
          <!-- ADDED: PDF Export Button -->
          <button
            id="exportPdfBtn"
            class="btn-secondary px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md font-medium text-sm"
          >
            <i class="fas fa-file-pdf mr-2"></i> Export as PDF
          </button>
          <button
            id="clearBtn"
            class="btn-secondary ml-auto px-4 py-2 bg-red-100 dark:bg-red-900/50 hover:bg-red-200 dark:hover:bg-red-900 text-red-700 dark:text-red-300 rounded-md font-medium text-sm"
          >
            <i class="fas fa-trash-alt mr-2"></i> Clear
          </button>
        </div>

        <div
          class="grid grid-cols-1 lg:grid-cols-2 gap-px bg-gray-300 dark:bg-gray-600 rounded-xl shadow-md overflow-hidden"
        >
          <!-- Input Section -->
          <div class="bg-white dark:bg-gray-800">
            <textarea
              id="markdownInput"
              class="editor-pane w-full h-full p-4 text-gray-900 dark:text-gray-100 bg-transparent focus:outline-none resize-none"
              spellcheck="false"
            ></textarea>
          </div>

          <!-- Output Section -->
          <div
            id="htmlOutput"
            class="preview-pane p-4 bg-white dark:bg-gray-900 overflow-auto prose prose-sm sm:prose-base max-w-none"
          ></div>
        </div>
      </main>

      <!-- Footer -->
      <footer
        class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700 text-center text-gray-600 dark:text-gray-400"
      >
        <p>
          Â© 2025 DevCrate. Write Markdown and see the rendered HTML output in
          real-time.
        </p>
      </footer>
    </div>

    <script src="assets/js/theme.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- DOM Elements ---
        const markdownInput = document.getElementById("markdownInput");
        const htmlOutput = document.getElementById("htmlOutput");
        const clearBtn = document.getElementById("clearBtn");
        const copyMarkdownBtn = document.getElementById("copyMarkdownBtn");
        const copyHtmlBtn = document.getElementById("copyHtmlBtn");
        const exportPdfBtn = document.getElementById("exportPdfBtn");

        // --- Initial Content ---
        const initialMarkdown = `# Welcome to the Markdown Previewer!

This tool renders your Markdown text into HTML in real-time.

## Features
- **Live Preview:** See changes as you type.
- **Syntax Highlighting:** Code blocks are automatically highlighted.
- **Secure:** HTML output is sanitized to prevent XSS attacks.
- **GitHub Flavored Markdown:** Includes support for tables, strikethrough, and more.
- **PDF Export:** You can now export the result to a PDF!

### Example Code Block
\`\`\`javascript
// A simple hello world function
function greet(name) {
  console.log(\`Hello, \${name}!\`);
}

greet('DevCrate User');
\`\`\`

### Example Table
| Feature             | Status      | Priority |
|---------------------|-------------|----------|
| Real-time           | Implemented | High     |
| Syntax Highlighting | Implemented | High     |
| PDF Export          | Implemented | Medium   |

> This is a blockquote. Isn't it neat?

Start typing in the left pane to see the magic happen!
`;
        markdownInput.value = initialMarkdown;

        // --- Marked.js Configuration ---
        marked.setOptions({
          renderer: new marked.Renderer(),
          highlight: function (code, lang) {
            const language = hljs.getLanguage(lang) ? lang : "plaintext";
            return hljs.highlight(code, { language }).value;
          },
          langPrefix: "hljs language-",
          pedantic: false,
          gfm: true,
          breaks: false,
          sanitize: false,
          smartypants: false,
          xhtml: false,
        });

        // --- Core Logic ---
        const updatePreview = () => {
          const markdownText = markdownInput.value;
          const dirtyHtml = marked.parse(markdownText);
          const cleanHtml = DOMPurify.sanitize(dirtyHtml);
          htmlOutput.innerHTML = cleanHtml;
        };

        // --- Event Listeners ---
        markdownInput.addEventListener("input", updatePreview);

        clearBtn.addEventListener("click", () => {
          markdownInput.value = "";
          updatePreview();
        });

        const showFeedback = (btn, iconClass, text) => {
          const originalContent = btn.innerHTML;
          btn.innerHTML = `<i class="fas ${iconClass} mr-2"></i> ${text}`;
          btn.disabled = true;
          setTimeout(() => {
            btn.innerHTML = originalContent;
            btn.disabled = false;
          }, 2000);
        };

        const copyTextToClipboard = (
          textToCopy,
          buttonElement,
          isHtml = false
        ) => {
          const textArea = document.createElement("textarea");
          textArea.style.position = "fixed";
          textArea.style.top = "-9999px";
          textArea.style.left = "-9999px";
          textArea.value = textToCopy;
          document.body.appendChild(textArea);
          textArea.focus();
          textArea.select();
          try {
            const successful = document.execCommand("copy");
            if (successful) {
              showFeedback(buttonElement, "fa-check text-green-500", "Copied!");
            } else {
              showFeedback(buttonElement, "fa-times text-red-500", "Failed!");
            }
          } catch (err) {
            console.error("Copy failed", err);
            showFeedback(buttonElement, "fa-times text-red-500", "Failed!");
          }
          document.body.removeChild(textArea);
        };

        copyMarkdownBtn.addEventListener("click", () => {
          copyTextToClipboard(markdownInput.value, copyMarkdownBtn);
        });

        copyHtmlBtn.addEventListener("click", () => {
          copyTextToClipboard(htmlOutput.innerHTML, copyHtmlBtn, true);
        });

        // --- UPDATED: PDF Export Logic ---
        exportPdfBtn.addEventListener("click", () => {
          showFeedback(exportPdfBtn, "fa-spinner fa-spin", "Generating...");

          const element = document.getElementById("htmlOutput");
          const wasDarkMode =
            document.documentElement.classList.contains("dark");

          // Save original styles
          const originalHeight = element.style.height;
          const originalOverflow = element.style.overflow;

          // Expand to fit all content
          element.style.height = "auto";
          element.style.overflow = "visible";

          if (wasDarkMode) {
            document.documentElement.classList.remove("dark");
          }

          const opt = {
            margin: [0.5, 0.5, 0.5, 0.5],
            filename: "markdown_preview.pdf",
            image: { type: "jpeg", quality: 0.98 },
            html2canvas: {
              scale: 2,
              useCORS: true,
              backgroundColor: "#ffffff",
            },
            jsPDF: { unit: "in", format: "a4", orientation: "portrait" },
          };

          html2pdf()
            .set(opt)
            .from(element)
            .save()
            .finally(() => {
              // Restore styles and theme
              element.style.height = originalHeight;
              element.style.overflow = originalOverflow;
              if (wasDarkMode) {
                document.documentElement.classList.add("dark");
              }
            });
        });

        // --- Initial Render ---
        updatePreview();
      });
    </script>
  </body>
</html>
