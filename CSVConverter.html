<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CSV/Excel Converter | DevCrate</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code&display=swap"
      rel="stylesheet"
    />
    <!-- SheetJS for Excel processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              mono: ['"Fira Code"', "monospace"],
            },
          },
        },
      };
    </script>
    <style>
      .theme-toggle {
        transition: all 0.3s ease;
      }
      .theme-toggle:hover {
        transform: rotate(15deg) scale(1.1);
      }
      .upload-zone {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .upload-zone::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(14, 165, 233, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }
      .upload-zone:hover::before {
        left: 100%;
      }
      .upload-zone.dragover {
        border-color: #0ea5e9;
        background-color: rgba(14, 165, 233, 0.05);
        transform: scale(1.02);
      }
      .file-icon {
        animation: bounce 2s infinite;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      .pulse-ring {
        animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
      }
      @keyframes pulse-ring {
        0% {
          transform: scale(0.8);
          opacity: 1;
        }
        100% {
          transform: scale(1.2);
          opacity: 0;
        }
      }
      .container {
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease-out;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .table-wrapper {
        max-height: 400px;
        overflow: auto;
      }
      .table-wrapper::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      .table-wrapper::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .dark .table-wrapper::-webkit-scrollbar-track {
        background: #374151;
      }
      .table-wrapper::-webkit-scrollbar-thumb {
        background: #0ea5e9;
        border-radius: 4px;
      }
      .table-wrapper::-webkit-scrollbar-thumb:hover {
        background: #0284c7;
      }
    </style>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 min-h-screen font-sans text-gray-800 dark:text-gray-200"
  >
    <div class="container mx-auto px-4 py-8">
      <header class="flex justify-between items-center mb-8">
        <div>
          <a href="DevCrate.html" class="flex items-center">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
              Dev<span class="text-primary-600 dark:text-primary-400"
                >Crate</span
              >
            </h1>
          </a>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            CSV/Excel File Converter
          </p>
        </div>
        <button
          id="themeToggle"
          class="theme-toggle bg-gray-200 dark:bg-gray-700 rounded-full p-3 text-gray-700 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 dark:focus:ring-offset-gray-900"
        >
          <i id="moonIcon" class="fas fa-moon"></i>
          <i id="sunIcon" class="fas fa-sun hidden"></i>
        </button>
      </header>

      <main>
        <div class="max-w-7xl mx-auto space-y-8">
          <!-- Upload Section -->
          <div
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-8"
          >
            <h2
              class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center"
            >
              <i class="fas fa-upload mr-2"></i>Upload Your File
            </h2>

            <div
              id="uploadZone"
              class="upload-zone border-3 border-dashed border-gray-300 dark:border-gray-600 rounded-xl p-12 text-center cursor-pointer"
            >
              <div class="file-icon text-6xl text-primary-500 mb-4">
                <i class="fas fa-file-csv"></i>
              </div>
              <h3 class="text-xl font-semibold mb-2">
                Drag & Drop your file here
              </h3>
              <p class="text-gray-500 dark:text-gray-400 mb-4">
                or click to browse
              </p>
              <p class="text-sm text-gray-400 dark:text-gray-500">
                Supports: CSV, XLS, XLSX (Max 10MB)
              </p>
              <input
                type="file"
                id="fileInput"
                class="hidden"
                accept=".csv,.xls,.xlsx"
              />
            </div>

            <div id="fileInfo" class="mt-6 hidden">
              <div
                class="bg-gradient-to-br from-primary-50 to-primary-100 dark:from-gray-700 dark:to-gray-800 rounded-lg p-4"
              >
                <div class="flex items-center justify-between">
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-12 h-12 bg-primary-500 rounded-lg flex items-center justify-center text-white"
                    >
                      <i id="fileTypeIcon" class="fas fa-file text-2xl"></i>
                    </div>
                    <div>
                      <p
                        id="fileName"
                        class="font-semibold text-gray-900 dark:text-white"
                      ></p>
                      <p
                        id="fileSize"
                        class="text-sm text-gray-600 dark:text-gray-400"
                      ></p>
                    </div>
                  </div>
                  <button
                    id="clearFile"
                    class="text-red-500 hover:text-red-700 transition-colors"
                  >
                    <i class="fas fa-times-circle text-2xl"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Conversion Options -->
          <div
            id="conversionSection"
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 hidden"
          >
            <h2
              class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center"
            >
              <i class="fas fa-exchange-alt mr-2"></i>Conversion Options
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label
                  class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block"
                >
                  Convert To:
                </label>
                <select
                  id="convertTo"
                  class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
                >
                  <option value="">Select format...</option>
                  <option value="csv">CSV (.csv)</option>
                  <option value="xlsx">Excel (.xlsx)</option>
                  <option value="xls">Excel 97-2003 (.xls)</option>
                </select>
              </div>

              <div>
                <label
                  class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 block"
                >
                  CSV Delimiter (for CSV output):
                </label>
                <select
                  id="delimiter"
                  class="w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
                >
                  <option value=",">Comma (,)</option>
                  <option value=";">Semicolon (;)</option>
                  <option value="\t">Tab</option>
                  <option value="|">Pipe (|)</option>
                </select>
              </div>
            </div>

            <div class="flex justify-center space-x-4">
              <button
                id="convertBtn"
                class="px-8 py-3 bg-primary-600 hover:bg-primary-700 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:scale-105"
              >
                <i class="fas fa-magic mr-2"></i>Convert File
              </button>
            </div>
          </div>

          <!-- Preview Section -->
          <div
            id="previewSection"
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 hidden"
          >
            <h2
              class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center"
            >
              <i class="fas fa-eye mr-2"></i>Data Preview
            </h2>

            <div class="mb-4 flex items-center justify-between">
              <div class="text-sm text-gray-600 dark:text-gray-400">
                <span id="rowCount" class="font-semibold">0</span> rows ×
                <span id="colCount" class="font-semibold">0</span> columns
              </div>
              <div class="text-sm text-gray-500 dark:text-gray-500">
                Showing first 100 rows
              </div>
            </div>

            <div
              class="table-wrapper border border-gray-200 dark:border-gray-700 rounded-lg"
            >
              <table
                id="previewTable"
                class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
              >
                <thead class="bg-gray-50 dark:bg-gray-900 sticky top-0">
                  <tr id="tableHeader"></tr>
                </thead>
                <tbody
                  id="tableBody"
                  class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
                ></tbody>
              </table>
            </div>
          </div>

          <!-- Download Section -->
          <div
            id="downloadSection"
            class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 hidden"
          >
            <h2
              class="text-2xl font-bold text-gray-900 dark:text-white mb-6 text-center"
            >
              <i class="fas fa-download mr-2"></i>Download Converted File
            </h2>

            <div class="flex justify-center">
              <button
                id="downloadBtn"
                class="px-10 py-4 bg-green-600 hover:bg-green-700 text-white font-bold text-lg rounded-lg shadow-lg hover:shadow-xl transition-all transform hover:scale-105"
              >
                <i class="fas fa-download mr-2"></i>Download File
              </button>
            </div>

            <div class="mt-6 text-center">
              <button
                id="convertAnother"
                class="text-primary-600 dark:text-primary-400 hover:underline"
              >
                <i class="fas fa-redo mr-1"></i>Convert Another File
              </button>
            </div>
          </div>

          <!-- Info Cards -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div
              class="bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-700 dark:to-gray-800 rounded-xl p-6"
            >
              <div class="text-3xl text-blue-600 dark:text-blue-400 mb-3">
                <i class="fas fa-file-csv"></i>
              </div>
              <h3 class="font-bold text-lg mb-2 text-gray-900 dark:text-white">
                CSV Support
              </h3>
              <p class="text-sm text-gray-700 dark:text-gray-300">
                Convert CSV files to Excel format with customizable delimiters
              </p>
            </div>

            <div
              class="bg-gradient-to-br from-green-50 to-emerald-100 dark:from-gray-700 dark:to-gray-800 rounded-xl p-6"
            >
              <div class="text-3xl text-green-600 dark:text-green-400 mb-3">
                <i class="fas fa-file-excel"></i>
              </div>
              <h3 class="font-bold text-lg mb-2 text-gray-900 dark:text-white">
                Excel Support
              </h3>
              <p class="text-sm text-gray-700 dark:text-gray-300">
                Convert Excel files (.xls, .xlsx) to CSV or between Excel
                formats
              </p>
            </div>

            <div
              class="bg-gradient-to-br from-purple-50 to-pink-100 dark:from-gray-700 dark:to-gray-800 rounded-xl p-6"
            >
              <div class="text-3xl text-purple-600 dark:text-purple-400 mb-3">
                <i class="fas fa-eye"></i>
              </div>
              <h3 class="font-bold text-lg mb-2 text-gray-900 dark:text-white">
                Live Preview
              </h3>
              <p class="text-sm text-gray-700 dark:text-gray-300">
                Preview your data before downloading the converted file
              </p>
            </div>
          </div>
        </div>
      </main>

      <footer
        class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700 text-center text-gray-600 dark:text-gray-400"
      >
        <p>© 2025 DevCrate. Convert CSV and Excel files with ease.</p>
      </footer>
    </div>

    <script>
      // Theme management
      const themeToggle = document.getElementById("themeToggle");
      const moonIcon = document.getElementById("moonIcon");
      const sunIcon = document.getElementById("sunIcon");
      const html = document.documentElement;

      const savedTheme = localStorage.getItem("theme") || "light";
      if (savedTheme === "dark") {
        html.classList.add("dark");
        moonIcon.classList.add("hidden");
        sunIcon.classList.remove("hidden");
      }

      themeToggle.addEventListener("click", () => {
        html.classList.toggle("dark");
        const isDark = html.classList.contains("dark");
        moonIcon.classList.toggle("hidden", isDark);
        sunIcon.classList.toggle("hidden", !isDark);
        localStorage.setItem("theme", isDark ? "dark" : "light");
      });

      // File handling
      const uploadZone = document.getElementById("uploadZone");
      const fileInput = document.getElementById("fileInput");
      const fileInfo = document.getElementById("fileInfo");
      const fileName = document.getElementById("fileName");
      const fileSize = document.getElementById("fileSize");
      const fileTypeIcon = document.getElementById("fileTypeIcon");
      const clearFile = document.getElementById("clearFile");
      const conversionSection = document.getElementById("conversionSection");
      const previewSection = document.getElementById("previewSection");
      const downloadSection = document.getElementById("downloadSection");
      const convertBtn = document.getElementById("convertBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const convertAnother = document.getElementById("convertAnother");
      const convertTo = document.getElementById("convertTo");

      let currentFile = null;
      let workbook = null;
      let convertedData = null;

      // Upload zone interactions
      uploadZone.addEventListener("click", () => fileInput.click());

      uploadZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        uploadZone.classList.add("dragover");
      });

      uploadZone.addEventListener("dragleave", () => {
        uploadZone.classList.remove("dragover");
      });

      uploadZone.addEventListener("drop", (e) => {
        e.preventDefault();
        uploadZone.classList.remove("dragover");
        const files = e.dataTransfer.files;
        if (files.length > 0) handleFile(files[0]);
      });

      fileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) handleFile(e.target.files[0]);
      });

      clearFile.addEventListener("click", resetConverter);

      function handleFile(file) {
        const validTypes = [
          "text/csv",
          "application/vnd.ms-excel",
          "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        ];

        const ext = file.name.split(".").pop().toLowerCase();
        const validExts = ["csv", "xls", "xlsx"];

        if (!validExts.includes(ext)) {
          showToast("Please upload a CSV or Excel file", "error");
          return;
        }

        if (file.size > 10 * 1024 * 1024) {
          showToast("File size must be less than 10MB", "error");
          return;
        }

        currentFile = file;
        fileName.textContent = file.name;
        fileSize.textContent = formatFileSize(file.size);

        const iconMap = {
          csv: "fa-file-csv",
          xls: "fa-file-excel",
          xlsx: "fa-file-excel",
        };
        fileTypeIcon.className = `fas ${iconMap[ext]} text-2xl`;

        fileInfo.classList.remove("hidden");
        fileInfo.classList.add("fade-in");

        processFile(file);
      }

      function processFile(file) {
        const reader = new FileReader();

        reader.onload = (e) => {
          const data = new Uint8Array(e.target.result);
          workbook = XLSX.read(data, { type: "array" });

          const ext = file.name.split(".").pop().toLowerCase();
          setupConversionOptions(ext);
          displayPreview();

          conversionSection.classList.remove("hidden");
          conversionSection.classList.add("fade-in");
          showToast("File loaded successfully!", "success");
        };

        reader.onerror = () => {
          showToast("Error reading file", "error");
        };

        reader.readAsArrayBuffer(file);
      }

      function setupConversionOptions(currentExt) {
        convertTo.innerHTML = '<option value="">Select format...</option>';

        if (currentExt === "csv") {
          convertTo.innerHTML += '<option value="xlsx">Excel (.xlsx)</option>';
          convertTo.innerHTML +=
            '<option value="xls">Excel 97-2003 (.xls)</option>';
        } else {
          convertTo.innerHTML += '<option value="csv">CSV (.csv)</option>';
          convertTo.innerHTML += '<option value="xlsx">Excel (.xlsx)</option>';
          convertTo.innerHTML +=
            '<option value="xls">Excel 97-2003 (.xls)</option>';
        }
      }

      function displayPreview() {
        const sheetName = workbook.SheetNames[0];
        const sheet = workbook.Sheets[sheetName];
        const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

        if (jsonData.length === 0) {
          showToast("No data found in file", "error");
          return;
        }

        const headers = jsonData[0];
        const rows = jsonData.slice(1, 101);

        document.getElementById("rowCount").textContent = jsonData.length - 1;
        document.getElementById("colCount").textContent = headers.length;

        const tableHeader = document.getElementById("tableHeader");
        const tableBody = document.getElementById("tableBody");

        tableHeader.innerHTML = headers
          .map(
            (h) =>
              `<th class="px-4 py-3 text-left text-xs font-medium text-gray-700 dark:text-gray-300 uppercase tracking-wider">${
                h || ""
              }</th>`
          )
          .join("");

        tableBody.innerHTML = rows
          .map(
            (row) =>
              `<tr class="hover:bg-gray-50 dark:hover:bg-gray-700">
            ${headers
              .map(
                (_, i) =>
                  `<td class="px-4 py-3 text-sm text-gray-900 dark:text-gray-100">${
                    row[i] || ""
                  }</td>`
              )
              .join("")}
          </tr>`
          )
          .join("");

        previewSection.classList.remove("hidden");
        previewSection.classList.add("fade-in");
      }

      convertBtn.addEventListener("click", () => {
        const format = convertTo.value;
        if (!format) {
          showToast("Please select a conversion format", "error");
          return;
        }

        try {
          const sheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[sheetName];

          if (format === "csv") {
            const delimiter = document.getElementById("delimiter").value;
            convertedData = XLSX.utils.sheet_to_csv(sheet, { FS: delimiter });
          } else {
            const newWorkbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(newWorkbook, sheet, sheetName);
            convertedData = XLSX.write(newWorkbook, {
              bookType: format,
              type: "array",
            });
          }

          downloadSection.classList.remove("hidden");
          downloadSection.classList.add("fade-in");
          downloadSection.scrollIntoView({ behavior: "smooth" });
          showToast("Conversion complete!", "success");
        } catch (err) {
          showToast("Conversion failed: " + err.message, "error");
        }
      });

      downloadBtn.addEventListener("click", () => {
        const format = convertTo.value;
        const originalName = currentFile.name.split(".")[0];
        const fileName = `${originalName}_converted.${format}`;

        const blob =
          format === "csv"
            ? new Blob([convertedData], { type: "text/csv" })
            : new Blob([convertedData], {
                type:
                  format === "xlsx"
                    ? "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                    : "application/vnd.ms-excel",
              });

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(url);

        showToast("File downloaded!", "success");
      });

      convertAnother.addEventListener("click", resetConverter);

      function resetConverter() {
        currentFile = null;
        workbook = null;
        convertedData = null;
        fileInput.value = "";
        fileInfo.classList.add("hidden");
        conversionSection.classList.add("hidden");
        previewSection.classList.add("hidden");
        downloadSection.classList.add("hidden");
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return (
          Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i]
        );
      }

      function showToast(msg, type = "success") {
        const bgColor = type === "success" ? "bg-green-500" : "bg-red-500";
        const toast = document.createElement("div");
        toast.className = `fixed bottom-4 right-4 ${bgColor} text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in`;
        toast.innerHTML = `<i class="fas fa-${
          type === "success" ? "check" : "exclamation"
        }-circle mr-2"></i>${msg}`;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
      }

      // Initial animation
      setTimeout(() => {
        document.querySelector(".container").style.opacity = "1";
        document.querySelector(".container").style.transform = "translateY(0)";
      }, 100);
    </script>
  </body>
</html>
